{{- $shell := index . "shell" -}}

{{- define "promptContext" -}}
ctx=""
if test -n "${TMUX}"; then
  ctx="${ctx}:tmux"
  if test "$SHLVL" -gt 2; then
    ctx="${ctx}:${SHLVL}"
  fi
else
  if test "$SHLVL" -gt 1; then
    ctx="${ctx}:${SHLVL}"
  fi
fi
if test -n "${ctx}"; then
  ctx="(${ctx})"
fi
{{- end -}}

{{- define "promptChar" -}}
pchar="$"
if test "$(id -u)" -eq 0; then
  pchar="#"
fi
{{- end -}}

{{- if eq $shell "zsh" -}}
export SPROMPT="Potential spelling error %R , could be %r"
{{ template "promptContext" $ }}
{{ template "promptChar" $ }}
export PROMPT="%n@%m:%~ ${ctx}\n${pchar} "
unset ctx pchar
{{- else if eq $shell "bash" -}}
{{ template "promptContext" $ }}
{{ template "promptChar" $ }}
export PS1='\u@\h:\w ${ctx}\n'"${pchar} "
unset ctx pchar
{{- else if eq $shell "ksh" -}}
{{ template "promptContext" $ }}
{{ template "promptChar" $ }}
export PS1='${USER}@$(hostname -s):${PWD} ${ctx}\n${pchar} '
unset ctx pchar
{{- else if eq $shell "tcsh" -}}
{{ template "promptContext" $ }}
{{ template "promptChar" $ }}
set prompt="%n@%m:%~ ${ctx}\n${pchar} "
unset ctx pchar
{{- else -}}
# Unknown shell for prompt
{{- end -}}
